{
  "hash": "7810c96cd9671eeca93e7fa77e3cec8b",
  "result": {
    "markdown": "---\ntitle: P708 - stranded mRNA-Seq analysis of Human fibroblast skin model\nauthor:\n  - name: Assa Yeroslaviz\n    orcid: 0000-0001-9638-4026\n    corresponding: true\n    email: yeroslaviz@biochem.mpg.de\n    roles:\n      - Investigation\n      - Visualization\n    affiliations:\n      - Max-Planck-Institute for Biochemistry\nkeywords:\n  - MPI. MR\n  - Dept. Spatz\n  - RNA-Seq\n  - Rahul Rimal\n  - Spheroids\n  - human fibroblast\nabstract: |\n  On June 2023 Rahul Rimal contacted Rinho and myself regarding the analysis of vascularized spheroids. The project contains two experimental conditions: a) Control Vascularized spheroids and b) Vascularized spheroids with Microgels. It was observed that addition of Microgels improves vascularization significantly. They would like to confirm this behavior based on the visual results acquired with sequencing data. \nplain-language-summary: |\n  RNA-Seq analysis with the goal of mapping and quantification of the two conditions\nkey-points:\n  - \ndate: last-modified\nbibliography: references.bib\ncitation:\n  container-title: Spheroid Analysis\nnumber-sections: true\nformat: \n  html:\n    code-fold: true\n---\n\n\n## Introduction\n\nIn the First email Rahul send he wrote:\n\n```         \nFor my project, I am also interested in conducting the sequencing and would be grateful to have your expertise. I am currently working with vascularized spheroids and have two experimental conditions:\n\na) Control Vascularized spheroids \nb) Vascularized spheroids with Microgels \n\nWe have observed that addition of Microgels improves vascularization significantly and would like to confirm the visual results we acquired with the sequencing data. \n \nI am in the process of preparing/extracting RNA from 3 technical and 3 biological replicates of each above mentioned conditions. Therefore, a total of 18 samples. \nEach sample contain 300 vascularized spheroids (roughly a million cells per sample). \n\nI would like to know whether sequencing of these samples is feasible for you and your schedule. Do let me know which month/date could be the most suitable for you to receive the samples (depending on your schedule).\n```\n\nSo, we have a 3x3 experimental design for two conditions.\n\nIn a followed up mail a few weeks later he asked for:\n\n```         \nFastq files are available. https://datashare.biochem.mpg.de/s/NMy4gBMQYzwTth1\nCould you please help me with this? \n\nI would require for now \n1) The PCA graph\n2) The volcano plot \n3) gene ontology graph\n\nCould you also provide me the excel sheet with the final gene expression values? \nEagerly waiting for the results. \n```\n\n# Preparation\n\nThe raw data is saved on the pool folder `pool-bcfngs` and was linked to my working folder.\n\n\n::: {.cell warning.hidden='true' message.hidden='true'}\n\n```{.bash .cell-code}\nmkdir -p /fs/home/yeroslaviz/projects/MPI_MR/Rahul/P708/rawData\ncd rawData/\nln -s /home/yeroslaviz/poolFolders/pool-bcfngs/fastq_files/P708/P708_20230808_Spatz_Rahul/conc.fastq/*. .\n```\n:::\n\n\n# Quality Control\n\nQuality control was done using the `fastqc` tool [@fastqc, v. 0.11.7] within the automated sequencing pipeline. QC looks good for all samples.\n\ngenerating a report using `multiQC` [@multiqc, v. 1.14] summarizing the QC Results.\n\n\n::: {.cell warning.hidden='true' message.hidden='true'}\n\n```{.bash .cell-code}\nconda activate Mapping\n\nmkdir ../fastqcResults\ncd  ../\nfastqc -t 22 -o fastqcResults/ rawData/*.gz\n\nmultiqc -o QC /fs/home/yeroslaviz/projects/MPI_MR/Rahul/P708/fastqcResults/\n```\n:::\n\n\n## Mapping\n\nMapping the samples was done using the STAR Aligner [@star, v. 2.7.10b]\n\n\n::: {.cell warning.hidden='true' message.hidden='true'}\n\n```{.bash .cell-code}\nbasisDir=\"/fs/home/yeroslaviz/projects/MPI_MR/Rahul/P708\"\nrawData=\"${basisDir}/rawData\"\noutput=\"${basisDir}/STAR_mapping\"\nmkdir -p $output\nstarIndex=\"/home/yeroslaviz/poolFolders/pool-bcfngs/genomes/Hsp.GRCh38/starIndex2.7.10a\"\ngtf=\"/home/yeroslaviz/poolFolders/pool-bcfngs/genomes/Hsp.GRCh38.gtf\"\n\nfor file in `ls $rawData/*R1.fastq.gz`\ndo\n    base=$(echo $file | sed -E \"s/\\/fs\\/home\\/yeroslaviz\\/projects\\/MPI_MR\\/Rahul\\/P708\\/rawData\\/(.*).conc.R1.fastq.gz/\\1/\")\n    echo -e \"\\n Mapping $base \\n\"\n    mkdir -p ${output}/$base/\n#    echo ${base}\n    STAR --runThreadN 20 --genomeDir $starIndex --sjdbGTFfile $gtf --sjdbOverhang 100 \\\n    --readFilesCommand zcat \\\n    --readFilesIn ${rawData}/$base.conc.R1.fastq.gz ${rawData}/$base.conc.R2.fastq.gz \\\n    --outFileNamePrefix ${output}/$base/ \\\n    --quantMode TranscriptomeSAM GeneCounts \\\n    --outSAMtype BAM SortedByCoordinate\n    mv ${output}/${base}/Aligned.sortedByCoord.out.bam ${output}/${base}.sorted.bam\n    samtools index ${output}/$base.sorted.bam\n    rm -rf ${output}/${base}/_STAR*\ndone\n\nconda deactivate\n```\n:::\n\n\n| Sample Name    | \\# read counts | \\# uniq Mapped | \\% uniq Mapped | \\# Multi-Mapped | \\% Multi-Mapped | TotalMapped |\n|-----------|-----------|-----------|-----------|-----------|-----------|-----------|\n| control_r1_1   | 14934832       | 13903988       | 93.10%         | 764217          | 5.117%          | 98.217%     |\n| control_r1_2   | 16851257       | 15957162       | 94.69%         | 652037          | 3.869%          | 98.559%     |\n| control_r1_3   | 17756996       | 16893231       | 95.14%         | 680413          | 3.832%          | 98.972%     |\n| control_r2_1   | 19058058       | 18107861       | 95.01%         | 778372          | 4.084%          | 99.094%     |\n| control_r2_2   | 17399089       | 16502506       | 94.85%         | 700218          | 4.024%          | 98.874%     |\n| control_r2_3   | 9044369        | 8510562        | 94.10%         | 369782          | 4.089%          | 98.189%     |\n| control_r3_1   | 20002695       | 19052374       | 95.25%         | 715315          | 3.576%          | 98.826%     |\n| control_r3_2   | 14401432       | 13746894       | 95.46%         | 503051          | 3.493%          | 98.953%     |\n| control_r3_3   | 23793484       | 22452657       | 94.36%         | 884989          | 3.719%          | 98.079%     |\n| microgels_r1_1 | 14394900       | 13739503       | 95.45%         | 530096          | 3.683%          | 99.133%     |\n| microgels_r1_2 | 19167758       | 18295504       | 95.45%         | 705631          | 3.681%          | 99.131%     |\n| microgels_r1_3 | 17222387       | 16408266       | 95.27%         | 650330          | 3.776%          | 99.046%     |\n| microgels_r2_1 | 18897903       | 18021886       | 95.36%         | 722859          | 3.825%          | 99.185%     |\n| microgels_r2_2 | 14837465       | 14155321       | 95.40%         | 553967          | 3.734%          | 99.134%     |\n| microgels_r2_3 | 14117159       | 13446885       | 95.25%         | 542432          | 3.842%          | 99.092%     |\n| microgels_r3_1 | 17627394       | 16817864       | 95.41%         | 673610          | 3.821%          | 99.231%     |\n| microgels_r3_2 | 14383836       | 13711139       | 95.32%         | 530871          | 3.691%          | 99.011%     |\n| microgels_r3_3 | 12048255       | 11495761       | 95.41%         | 453869          | 3.767%          | 99.177%     |\n|                |                |                |                |                 |                 |             |\n\nmapping with `quantMode` and Sam output file\n\n\n::: {.cell warning.hidden='true' message.hidden='true'}\n\n```{.r .cell-code .hidden}\neruptions <- c(1492, 1585, 1646, 1677, 1712, 1949, 1971, 2021)\nn_eruptions <- length(eruptions)\n```\n:::\n\n::: {#cell-fig-timeline .cell warning.hidden='true' message.hidden='true'}\n\n```{.r .cell-code .hidden}\npar(mar = c(3, 1, 1, 1) + 0.1)\nplot(eruptions, rep(0, n_eruptions), \n  pch = \"|\", axes = FALSE)\naxis(1)\nbox()\n```\n\n::: {.cell-output-display}\n![Timeline of recent earthquakes on La Palma](index_files/figure-html/fig-timeline-1.png){#fig-timeline fig-alt='An event plot of the years of the last 8 eruptions on La Palma.' width=576}\n:::\n:::\n\n::: {.cell warning.hidden='true' message.hidden='true'}\n\n```{.r .cell-code .hidden}\navg_years_between_eruptions <- mean(diff(eruptions[-n_eruptions]))\navg_years_between_eruptions\n```\n\n::: {.cell-output .cell-output-stdout .hidden}\n\n```\n[1] 79.83333\n```\n\n\n:::\n:::\n\n\nBased on data up to and including 1971, eruptions on La Palma happen every 79.8 years on average.\n\nStudies of the magma systems feeding the volcano, such as @marrero2019, have proposed that there are two main magma reservoirs feeding the Cumbre Vieja volcano; one in the mantle (30-40km depth) which charges and in turn feeds a shallower crustal reservoir (10-20km depth).\n\nEight eruptions have been recorded since the late 1400s (@fig-timeline).\n\nData and methods are discussed in @sec-data-methods.\n\nLet $x$ denote the number of eruptions in a year. Then, $x$ can be modeled by a Poisson distribution\n\n$$\np(x) = \\frac{e^{-\\lambda} \\lambda^{x}}{x !}\n$$ {#eq-poisson}\n\nwhere $\\lambda$ is the rate of eruptions per year. Using @eq-poisson, the probability of an eruption in the next $t$ years can be calculated.\n\n| Name                | Year |\n|---------------------|------|\n| Current             | 2021 |\n| Teneguía            | 1971 |\n| Nambroque           | 1949 |\n| El Charco           | 1712 |\n| Volcán San Antonio  | 1677 |\n| Volcán San Martin   | 1646 |\n| Tajuya near El Paso | 1585 |\n| Montaña Quemada     | 1492 |\n\n: Recent historic eruptions on La Palma {#tbl-history}\n\n@tbl-history summarises the eruptions recorded since the colonization of the islands by Europeans in the late 1400s.\n\n![Map of La Palma](images/la-palma-map.png){#fig-map}\n\nLa Palma is one of the west most islands in the Volcanic Archipelago of the Canary Islands (@fig-map).\n\n\n{{< embed notebooks/explore-earthquakes.qmd#fig-spatial-plot >}}\n\n\n\n@fig-spatial-plot shows the location of recent Earthquakes on La Palma.\n\n## Data & Methods {#sec-data-methods}\n\n## Conclusion\n\n## References {.unnumbered}\n\n::: {#refs}\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}